# AmoSendlerยโฑ๏ธยโย๐ผ

> **ะัะณะบะฐั PHPโัะพัะผะฐ, ะบะพัะพัะฐั ะฒยะพะดะธะฝยะบะปะธะบ ัะพะทะดะฐัั ัะดะตะปะบั ะธยะบะพะฝัะฐะบั ะฒยAmoCRMย(Kommo)**
> ะธ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะพะผะตัะฐะตั, ะฑัะปยะปะธ ะฟะพัะตัะธัะตะปั ะฝะฐยะปะตะฝะดะธะฝะณะต ะดะพะปััะตย30ยัะตะบัะฝะด.

---

## โจยะะพัะตะผั ััะพ ัะดะพะฑะฝะพ

| ยะคะธัะฐย                    | ยะงัะพ ะฟะพะปััะฐะตั ะผะฐัะบะตัะพะปะพะณย                                     |
| ------------------------- | ------------------------------------------------------------- |
| **ZeroยJSโัะฐะนะผะตั**        | ะัะตะผั ะฟัะตะฑัะฒะฐะฝะธั ะฒััะธัะปัะตััั ะฝะฐยPHP, ััะพะฝั ะพััะฐัััั โัะธัััะผโ  |
| **APIยv4 ะพะดะฝะธะผ ะทะฐะฟัะพัะพะผ** | `/leads/complex` โ ััะฐะทั ัะดะตะปะบะฐ **ะธ** ะบะพะฝัะฐะบั                 |
| **ะงะตะบโะฑะพะบัยโ>ย30ยัะตะบโ**   | ะะพะผะตะฝัะฐะปัะฝะพ ะฒะธะดะฝะพ, ัะพะฑะธัะฐะปยะปะธยะปะธะด ะบะพะฝัะตะฝั ะฝะฐยัััะฐะฝะธัะต         |
| **ะะตะท ะฟะตัะตะทะฐะณััะทะบะธ**      | ะัะพัััะต `alert()` ะฝะฐยััะฟะตั / ะพัะธะฑะบั โ UX ะฝะตยะปะพะผะฐะตััั          |
| **ะงะธัััะนยPHPย7.4+**       | ะะฐะฑะพัะฐะตั ะดะฐะถะต ะฝะฐยัะฐะผะพะผ ะฑัะดะถะตัะฝะพะผ sharedโัะพััะธะฝะณะต              |

---

## ๐ยะกัััะบัััะฐ

```text
/public_html/
โโ AmoSendler/
   โโ index.php      # ัััะฐะฝะธัะฐโัะพัะผะฐ (HTMLย+ยะผะธะฝะธะผะฐะปัะฝัะน JS)
   โโ lead.php       # ัะตัะฒะตัะฝัะน ะพะฑัะฐะฑะพััะธะบ, ะพะฑัะฐะตััั ัยAmoCRM
   โโ style.css      # ะพะฟัะธะพะฝะฐะปัะฝัะต ััะธะปะธ (ะฟะพะดะบะปััะธัะต ัะฒะพะธ)
```

---

## โ๏ธยะขัะตะฑะพะฒะฐะฝะธั

* **PHPย7.4+** c ะฒะบะปัััะฝะฝัะผ ัะฐััะธัะตะฝะธะตะผ `curl`
* ะฅะพััะธะฝะณ (sharedย/ยVPS) ั HTTPSโะดะพะผะตะฝะพะผ
* ะะบะบะฐัะฝั **AmoCRM** ั ะดะพัััะฟะพะผ ยซะะดะผะธะฝะธัััะฐัะพัยป

---

## ๐ยะฃััะฐะฝะพะฒะบะฐ ะทะฐย5ยัะฐะณะพะฒ

1. **ะะปะพะฝะธััะนัะต** ัะตะฟะพะทะธัะพัะธะน ะฒ ะฟะฐะฟะบั ัะฐะนัะฐ.
2. ะ AmoCRM ัะพะทะดะฐะนัะต **ะะฝะตัะฝัั ะธะฝัะตะณัะฐัะธั** โ ัะพััะฐะฝะธัะต `client_id`, `client_secret`, ะฟะพะปััะธัะต `authorization_code` โ ะพะฑะผะตะฝัะนัะต ะฝะฐ `access_token` / `refresh_token`.
3. ะ ะบะฐััะพัะบะต **ะกะดะตะปะบะธ** ะดะพะฑะฐะฒััะต ัะตะบโะฑะพะบัโะฟะพะปะต ยซะะฐยัะฐะนัะตย>ย30ยัะตะบยป ะธยะทะฐะฟะพะผะฝะธัะต ะตะณะพ **ID** (ะฝะฐะฟัะธะผะตั `338991`).
4. ะัะบัะพะนัะต `lead.php`, ะทะฐะฟะพะปะฝะธัะต ะบะพะฝััะฐะฝัั:

   ```php
   const SUBDOMAIN     = 'mycompany';   // ะฑะตะท .amocrm.ru
   const ACCESS_TOKEN  = 'โขโขโข';
   const REFRESH_TOKEN = 'โขโขโข';
   const TIME_FIELD_ID = 338991;        // ID ัะตะบโะฑะพะบัะฐ
   ```
5. ะะฐะณััะทะธัะต ัะฐะนะปั, ะพัะบัะพะนัะต `index.php` โ ัะตััะพะฒะฐั ะทะฐัะฒะบะฐ ะดะพะปะถะฝะฐ ะฟะพัะฒะธัััั ะฒยCRM.

---

## ๐บ๏ธยะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

```mermaid
sequenceDiagram
  participant User
  participant Browser
  participant PHP\(index.php)
  participant PHP\(lead.php)
  participant AmoCRM

  User->>Browser: ะะฐะณััะถะฐะตั ัััะฐะฝะธัั
  Browser->>PHP\(index.php): GET
  PHP\(index.php)-->>Browser: HTML + hidden started=time()
  User-->>Browser: ะะฐะฟะพะปะฝัะตั ัะพัะผั
  Browser->>PHP\(lead.php): POST {name,email,phone,price,started}
  PHP\(lead.php)->>PHP\(lead.php): time() - started > 30 ? true:false
  PHP\(lead.php)->>AmoCRM: POST /leads/complex
  AmoCRM-->>PHP\(lead.php): 201 Created + IDs
  PHP\(lead.php)-->>Browser: JSON {ok:true}
  Browser-->>User: alert("ะกะฟะฐัะธะฑะพ! ะะฐัะฒะบะฐ #ID ัะพะทะดะฐะฝะฐ")
```

---

## ๐งโ๐ปยะัะฟะพะปัะทะพะฒะฐะฝะธะต

| ะะตะนััะฒะธะต                    | ะะตะทัะปััะฐั ะฒ CRM                          |
| --------------------------- | ---------------------------------------- |
| ะัะฟัะฐะฒะธัั ัะพัะผั ะผะพะปะฝะธะตะฝะพัะฝะพ | ะะพะปะตโัะปะฐะณยโ `false` / *ะณะฐะปะพัะบะฐยะฝะตยััะพะธั* |
| ะะพะดะตัะถะฐัั ัััะฐะฝะธัั 30ยัะตะบ   | ะะพะปะตโัะปะฐะณยโ `true` / *ะณะฐะปะพัะบะฐยััะพะธั*     |

---

## ๐ยะะตะทะพะฟะฐัะฝะพััั &ยDevยnotes

* ะฅัะฐะฝะธัะต ัะพะบะตะฝั **ะฒะฝะต ัะตะฟะพะทะธัะพัะธั** (ะฝะฐะฟัะธะผะตั, ะฒ `.env` ะธ ะฟัะพะบะธะดัะฒะฐะนัะต ัะตัะตะท `putenv()`).
* ะะตยะทะฐะปะธะฒะฐะนัะต ัะฐะนะป `access_token.tmp` ะฒยGit.
* ะะฐัะธัะธัะต ะบะฐัะฐะปะพะณ `/AmoSendler/` ัะตัะตะท `.htaccess`, ะตัะปะธ ะฝะต ัะพัะธัะต, ััะพะฑั `lead.php` ะฑัะป ะฟัะฑะปะธัะตะฝ.
* ะ combatโัะตะถะธะผะต ะทะฐะผะตะฝะธัะต `alert()` ะฝะฐ ะผะพะดะฐะปัะฝะพะต ะพะบะฝะพ ะธะปะธ ะบะฐััะพะผะฝัะน Toast.

---

## ๐ยะะธัะตะฝะทะธั

ยฉย2025ยโ ะกะดะตะปะฐะฝะพ ัยโฅ ะพัยJQuBiiK. Fork, ะทะฒะตะทะดะฐ ะธยPRโั ะฟัะธะฒะตัััะฒััััั!
